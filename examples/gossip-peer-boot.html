<!DOCTYPE HTML> 
<html lang="en"> 
  <head>
    <title>PeerJS Broadcast Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Language" content="en-us">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script> 
  <script type="text/javascript" src="../bower_components/peerjs/peer.js"></script>
  <script type="text/javascript" src="../lib/peerjs-gossip.js"></script>
  </head> 
 
  <body>
    <peer-server>
      <ip id="peerserver-ip"></ip>
      <port id="peerserver-port"></port>
    </peer-server>
    <gossip-params>
      <cache id="cache-size"></cache>
      <view id="first-view-size"></view>
      <l-p id="l-parameter"></l-p>
      <period id="gossip-period"></period>
    </gossip-params>
    <peer-params>
      <bootable id="bootable"></bootable>
    </peer-params>

<script>
console.log($('#peerserver-ip').text());
peer = new GossipPeer({
  host: $('#peerserver-ip').text(),
  port: parseInt($('#peerserver-port').text()),
  debug: 3,
  logFunction: function(){
    var copy = Array.prototype.slice.call(arguments).join(' ');
    console.log(copy);
  },
  cacheSize: parseInt($('#cache-size').text()),
  firstViewSize: parseInt($('#first-view-size').text()),
  l: parseInt($('#l-parameter').text()),
  gossipPeriod: parseInt($('#gossip-period').text()),
  bootable: $('#bootable').text()
});

peer.on('open', function(id){
  $('#pid').text(id);
  if(!peer.options.bootable){
    $('.log').append('Request first view to server... <br>');
    peer.emit('randomView');
  }
  else{
    $('.log').append('I am a bootable peer <br>');
  }
});

  $(document).ready(function() {
    $('#browsers').text(navigator.userAgent);
  });
// Make sure things clean up properly.

window.onunload = window.onbeforeunload = function(e) {
  if (!!peer && !peer.destroyed) {
      peer.destroy();
    }
};
</script>

  </body> 
</html> 
